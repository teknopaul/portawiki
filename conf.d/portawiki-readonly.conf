#
#  This config file configures Apache to serve the HTML content generated by portawiki.
#  The SSI includes are redirected by versions in /ro_app/ that dont have the edit options.
#  Other static content i.e. css and img files are served from /app/ as normal
#
<VirtualHost *:80>
   ServerName portawiki
   ServerAdmin info@portawiki
   DocumentRoot /home/nodeuser/portawiki/content
   ErrorLog logs/portawiki-error_log
   CustomLog logs/portawiki-access_log common

   #
   # The Apache version of the contents of ssi-environment.xml
   # 
   SetEnv serverName PortaWiki
   SetEnv copyRight tp23.org
   
   #
   # Alias /view/ directly to the HTML content stored on disk
   #
   Alias /view/  /home/nodeuser/portawiki/content/
   <Directory /home/nodeuser/portawiki/content>
      Options Indexes FollowSymLinks Includes MultiViews
      IndexOptions +SuppressHTMLPreamble -FancyIndexing SuppressIcon SuppressColumnSorting SuppressLastModified SuppressDescription
      Allow from all
      AllowOverride None
      AddHandler server-parsed .html
      HeaderName /ro_app/HEADER.html
      ReadmeName /ro_app/FOOTER.html
   </Directory>

   #
   # Alias /app/ to the client static content
   #
   Alias /app/ /home/nodeuser/portawiki/client/app/
   <Directory /home/nodeuser/portawiki/client/app>
      Options Indexes FollowSymLinks Includes MultiViews
      Allow from all
      AllowOverride None
      AddHandler server-parsed .html
   </Directory>

   #
   # .html$ files from /app/ will be overriden by /ro_app/ for SSI includes
   # this setup up the directory under that virtual path /ro_app/  Rewrite does the mapping
   #
   Alias /ro_app/ /home/nodeuser/portawiki/client/ro_app/
   <Directory /home/nodeuser/portawiki/client/ro_app>
      Options Indexes FollowSymLinks Includes MultiViews
      Allow from all
      AllowOverride None
      AddHandler server-parsed .html
   </Directory>

   DirectoryIndex index.html

   #
   # rewrite .htmls used by SSI to /ro_app/  PT ensures that then Aliasing works
   #
   ReWriteEngine on
   ReWriteRule ^/app/(.*\.html$)    /ro_app/$1 [L,PT]

</VirtualHost>

#
# If you want to publish the node.js server on the t'internet you should do something akin to the following
# Make usre you setup authenitcation first.
# N.B. pretty silly to have all the power of node with Apache in front if performance is an issue
#
#<VirtualHost *:443>
#        DocumentRoot "/home/nodeuser/portawiki/content/"
#        ServerName portawiki:443
#        ErrorLog "/var/log/httpd/portawiki-ssl_error_log"
#        TransferLog "/var/log/httpd/portawiki-ssl_access_log"
#        CustomLog /var/log/httpd/portawiki-ssl_request_log "%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \"%r\" %b"
#        LogLevel warn
#        SSLEngine on
#        SSLProtocol all -SSLv2
#        SSLCipherSuite ALL:!ADH:!EXPORT:!SSLv2:RC4+RSA:+HIGH:+MEDIUM:+LOW
#        SSLCertificateFile /etc/pki/tls/certs/localhost.crt
#        SSLCertificateKeyFile /etc/pki/tls/private/localhost.key
#
#        SetEnvIf User-Agent ".*MSIE.*" \
#                nokeepalive ssl-unclean-shutdown \
#                downgrade-1.0 force-response-1.0
#
#        ProxyPass / http://localhost:8000/
#        ProxyPassReverse / http://localhost:8000/
#
#</VirtualHost> 
#